# setTimeout、Promise、Async/Await 的区别

JS 运行机制

## 概念 1： JS 是单线程执行

”JS 是单线程的”指的是 JS 引擎线程。

```
  在浏览器环境中，有JS 引擎线程和渲染线程，且两个线程互斥。
  Node环境中，只有JS 线程。
```

## 概念 2：宿主

JS 运行的环境。一般为浏览器或者 Node。

## 概念 3：执行栈

是一个存储函数调用的栈结构，遵循先进后出的原则。

当开始执行 JS 代码时，首先会执行一个 main 函数，然后执行我们的代码。根据先进后出的原则，后执行的函数会先弹出栈，在图中我们也可以发

现，foo 函数后执行，当执行完毕后就从栈中弹出了。

## 概念 4：Event Loop

```
当我们执行 JS 代码的时候其实就是往执行栈中放入函数，那么遇到异步代码的时候该怎么办？其实当遇到异步的代码时，会被挂起并在需要执行的时候加入到 Task（有多种 Task） 队列中。一旦执行栈为空，Event Loop 就会从 Task 队列中拿出需要执行的代码并放入执行栈中执行，所以本质上来说 JS 中的异步还是同步行为。
不同的任务源会被分配到不同的 Task 队列中，任务源可以分为 微任务（microtask） 和 宏任务（macrotask）。
```

Event Loop 执行顺序如下所示：

- 首先执行同步代码，这属于宏任务
- 当执行完所有同步代码后，执行栈为空，查询是否有异步代码需要执行
- 执行所有微任务
- 当执行完所有微任务后，如有必要会渲染页面
- 然后开始下一轮 Event Loop，执行宏任务中的异步代码，也就是 setTimeout 中的回调函数
